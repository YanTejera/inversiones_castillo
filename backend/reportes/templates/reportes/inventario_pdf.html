{% extends "reportes/base_pdf.html" %}

{% block title %}Reporte de Inventario - Inversiones C&C{% endblock %}

{% block report_title %}Reporte de Inventario{% endblock %}

{% block content %}
    <!-- Valoración Total -->
    <div class="section">
        <div class="section-title">Valoración del Inventario</div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Total Unidades</div>
                <div class="stat-value">{{ valoracion_total.total_unidades|default:0 }}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Valor Inventario (Compra)</div>
                <div class="stat-value currency">${{ valoracion_total.valor_total_compra|floatformat:0|default:0 }}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Valor Potencial (Venta)</div>
                <div class="stat-value currency">${{ valoracion_total.valor_total_venta|floatformat:0|default:0 }}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Ganancia Potencial</div>
                <div class="stat-value currency text-success">
                    ${% widthratio valoracion_total.valor_total_venta 1 1 %}{% widthratio valoracion_total.valor_total_compra 1 -1 %}
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Crítico -->
    {% if stock_critico %}
    <div class="section">
        <div class="section-title">⚠️ Productos con Stock Crítico</div>
        <table>
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Color</th>
                    <th class="text-right">Stock Actual</th>
                    <th class="text-center">Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in stock_critico %}
                <tr>
                    <td>{{ producto.modelo__marca }}</td>
                    <td>{{ producto.modelo__modelo }}</td>
                    <td>{{ producto.color }}</td>
                    <td class="text-right text-danger">{{ producto.cantidad_stock }}</td>
                    <td class="text-center">
                        <span class="text-danger">⚠️ Crítico</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Inventario Actual -->
    {% if inventario_actual %}
    <div class="section">
        <div class="section-title">Inventario Actual</div>
        <table>
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Color</th>
                    <th class="text-right">Stock</th>
                    <th class="text-right">Precio Compra</th>
                    <th class="text-right">Precio Venta</th>
                    <th class="text-right">Valor Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in inventario_actual %}
                <tr>
                    <td>{{ item.modelo__marca }}</td>
                    <td>{{ item.modelo__modelo }}</td>
                    <td>{{ item.color }}</td>
                    <td class="text-right">{{ item.cantidad_stock }}</td>
                    <td class="text-right currency">${{ item.modelo__precio_compra|floatformat:0 }}</td>
                    <td class="text-right currency">${{ item.modelo__precio_venta|floatformat:0 }}</td>
                    <td class="text-right currency">${{ item.valor_inventario|floatformat:0 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Rotación de Inventario -->
    {% if rotacion_inventario %}
    <div class="section page-break">
        <div class="section-title">Rotación de Inventario (Últimos 3 Meses)</div>
        <table>
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th class="text-right">Unidades Vendidas</th>
                    <th class="text-right">Ingresos Generados</th>
                    <th class="text-center">Movimiento</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in rotacion_inventario %}
                <tr>
                    <td>{{ producto.moto__marca }}</td>
                    <td>{{ producto.moto__modelo }}</td>
                    <td class="text-right">{{ producto.unidades_vendidas }}</td>
                    <td class="text-right currency">${{ producto.ingresos_generados|floatformat:0 }}</td>
                    <td class="text-center">
                        {% if producto.unidades_vendidas > 5 %}
                            <span class="text-success">Alto</span>
                        {% elif producto.unidades_vendidas > 2 %}
                            <span class="text-warning">Medio</span>
                        {% else %}
                            <span class="text-danger">Bajo</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Productos sin Movimiento -->
    {% if productos_sin_movimiento %}
    <div class="section">
        <div class="section-title">Productos sin Movimiento</div>
        <table>
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th class="text-right">Precio Compra</th>
                    <th class="text-right">Precio Venta</th>
                    <th class="text-center">Recomendación</th>
                </tr>
            </thead>
            <tbody>
                {% for producto in productos_sin_movimiento %}
                <tr>
                    <td>{{ producto.marca }}</td>
                    <td>{{ producto.modelo }}</td>
                    <td class="text-right currency">${{ producto.precio_compra|floatformat:0 }}</td>
                    <td class="text-right currency">${{ producto.precio_venta|floatformat:0 }}</td>
                    <td class="text-center text-warning">Revisar estrategia</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
{% endblock %}